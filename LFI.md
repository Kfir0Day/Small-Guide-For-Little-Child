LFI - Local File Inclusion
# המטרה
כאן המטרה היא לקחת טעינה של קובץ מסוים, ולעשות מניפולציה כדי להגיע לאזורים אחרים בשרת של האתר ולטעון קבצים סודיים כמו /etc/passwd או קובץ שנידרש להגיע אליו (לפעמים קוראים לזה secret.txt או flag.txt)
# אינדיקציה
* טעינת קבצים כלשהי בurl אם זה בשיטת GET
* בגוף הבקשה אם זה בPOST
* לדוגמא יראה משהו כזה:
```
http://example.com/get-files.jsp?file=report.pdf  
http://example.com/get-page.php?home=aaa.html  
http://example.com/some-page.asp?page=index.html
```
* יש לנו קבצים כלשהם שרואים אותם באתר
* אם יש לנו מצב של [[Insecure Deserilization]] שקורא אובייקטים אז נוכל לעשות דרכו LFI
* אם יש לנו [[RFI]] אז בסבירות גבוהה גם יהיה פגיעות LFI
# ניצול
1) איתור אזור פגיע
2) בדיקת הכללת קבצים
3) הרצה או קריאה של קבצים

* כדי לבצע LFI אנחנו צריכים לזוז במערכת וזה קורא באמצעות השיטה:
א) Path Traversal - שימוש בטקטיקה של `/../..` כדי ללכת אחורה ולנסות לכולו קבצים לדוגמא 
```
http://example.com/get-files?file=../../../../somedir/somefile  
http://example.com/../../../../etc/shadow  
http://example.com/get-files?file=../../../../etc/passwd
```
ב) לפעמים גם יש שימוש בdirectory traversal שזה בערך אותו עיקרון

* הצלחנו אם הצלחנו לקרוא קבצים מקומיים או להריץ קבצים מקומיים במערכת


### Insecure Deserilization to LFI
* נניח גילינו שיש אובייקט שניתן לנצל בבקשה כזאת למשל:
```
GET /api.php?s=O:6:"Logger":1:{s:8:"FileName";s:4:"ido";} HTTP/1.1
```
* נוכל להשתמש בשיטות של LFI בתוך האזור שטוען קבצים שכאן זה FileName למשל:
* `../../etc/passwd` - קובץ הסיסמאות בלינוקס
```
GET /api.php?s=O:6:"Logger":1:{s:8:"FileName";s:4:"../../etc/passwd";} HTTP/1.1
```

# חשוב !
* זה פגיעות שמזכירה את LFI אבל הם שונות במהות:
	* פגיעות [[LFI]] מנצלת **את מנגנון טעינת הקבצים של המערכת** לחשוף קבצים שלא אמורים לראות
	* פגיעות [[IDOR]] מנצלת **את מנגנון אימות משתמשים לא נכון** שמאפשר לנו לדלג מהמשתמש שלנו אל משתמש אחר או להחליף אותו, זה bypass למנגנון אימות במערכת